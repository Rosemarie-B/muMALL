%======================================================%
% Rules of Î¼MALL
%======================================================%

LF mu : lctx _ â†’ type =

| mu/init :
  dual A A'
  â†’ upd Î” A' ğŸ™ ğŸ˜ Î”' â†’ upd Î”' A ğŸ™ ğŸ˜ Î”'' â†’ exh Î”''
  â†’ mu Î”

| mu/â‘  :
  upd Î” â‘  ğŸ™ ğŸ˜ Î”' â†’ exh Î”'
  â†’ mu Î”

| mu/âŠ¥ :
  upd Î” âŠ¥ ğŸ™ ğŸ˜ Î”'
  â†’ mu Î”'
  â†’ mu Î”

| mu/âŠ¤ :
  upd Î” âŠ¤ ğŸ™ ğŸ™ Î”
  â†’ mu Î”

| mu/âŠ— :
  upd Î”â‚‚ (A âŠ— B) ğŸ™ ğŸ˜ Î”â‚‚'
  â†’ merge Î”â‚ Î”â‚‚ Î”
  â†’ (mu (cons Î”â‚ A ğŸ™))
  â†’ (mu (cons Î”â‚‚' B ğŸ™))
  â†’ mu Î”

| mu/â…‹ :
  upd Î” (A â…‹ B) ğŸ™ ğŸ˜ Î”'
  â†’ (mu (cons (cons Î”' B ğŸ™) A ğŸ™))
  â†’ mu Î”

| mu/cut :
  dual A A'
  â†’ merge Î”â‚ Î”â‚‚ Î”
  â†’ (mu (cons Î”â‚ A ğŸ™))
  â†’ (mu (cons Î”â‚‚ A' ğŸ™))
  â†’ mu Î”

| mu/âŠ•l :
  upd Î” (A âŠ• B) ğŸ™ ğŸ˜ Î”'
  â†’ (mu (cons Î”' A ğŸ™))
  â†’ mu Î”

| mu/âŠ•r :
  upd Î” (A âŠ• B) ğŸ™ ğŸ˜ Î”'
  â†’ (mu (cons Î”' B ğŸ™))
  â†’ mu Î”

| mu/& :
  upd Î” (A & B) ğŸ™ ğŸ˜ Î”'
  â†’ (mu (cons Î”' A ğŸ™))
  â†’ (mu (cons Î”' B ğŸ™))
  â†’ mu Î”

| mu/eq :
  upd Î” (t eq t') ğŸ™ ğŸ˜ Î”' â†’ exh Î”' â†’ nat_eq t t'
  â†’ mu Î”

| mu/â‰  :
  upd Î” (t â‰  t') ğŸ™ ğŸ˜ Î”' â†’ exh Î”' â†’ neq t t'
  â†’ mu Î”

| mu/âˆ€ :
  upd Î” (âˆ€ (\x. A x)) ğŸ™ ğŸ˜ Î”'
  â†’ ({y:nat} mu (cons Î”' (A y) ğŸ™))
  â†’ mu Î”

| mu/âˆƒ :
  eqt (A _) B
  â†’ upd Î” (âˆƒ A) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' B ğŸ™)
  â†’ mu Î”

| mu/Î¼Î½0 :
  dual (Î¼0 A) (Î½0 A')
  â†’ upd Î” (Î¼0 A) ğŸ™ ğŸ˜ Î”'
  â†’ upd Î”' (Î½0 A') ğŸ™ ğŸ˜ Î”'' â†’ exh Î”''
  â†’ mu Î”

| mu/Î¼0 :
  upd Î” (Î¼0 A) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î¼0 A)) ğŸ™)
  â†’ mu Î”

| mu/unfold0 :
  upd Î” (Î½0 A) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î½0 A)) ğŸ™)
  â†’ mu Î”

| mu/Î½0ex :
  upd Î” (Î½0\N. A âŠ• (A âŠ• N)) ğŸ™ ğŸ˜ Î”'
  â†’ dual (A âŠ• (Î½0\N. (A âŠ• N))) (A' & (Î¼0\N. (A' & N)))
  â†’ mu (cons Î”' (A âŠ• (Î½0\N. (A âŠ• N))) ğŸ™)
  â†’ mu (cons (cons nil (A âŠ• (A âŠ• (A âŠ• (Î½0\N. (A âŠ• N))))) ğŸ™) (A' & (Î¼0\N. (A' & N))) ğŸ™)
  â†’ mu Î”

| mu/C :
  neg A
  â†’ upd Î” A ğŸ™ ğŸ™ Î”'
  â†’ mu (cons Î”' A ğŸ™)
  â†’ mu Î”

| mu/W :
  neg A
  â†’ upd Î” A ğŸ™ ğŸ˜ Î”'
  â†’ mu Î”'
  â†’ mu Î”

%{=====================================================%
% General form of various Î¼/Î½ rules.
% The following will not type-check when used due to
% unification contraints.
%======================================================%

| mu/Î¼1 :
  upd Î” (Î¼1 A T) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î¼1 A) T) ğŸ™)
  â†’ mu Î”

| mu/Î¼2 :
  upd Î” (Î¼2 A T1 T2) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î¼2 A) T1 T2) ğŸ™)
  â†’ mu Î”      

| mu/Î¼3 :
  upd Î” (Î¼3 A T1 T2 T3) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î¼3 A) T1 T2 T3) ğŸ™)
  â†’ mu Î”

| mu/unfold1 :
  upd Î” (Î½1 A T) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (A (Î½1 A) T) ğŸ™)
  â†’ mu Î”

| mu/Î½0 :
  upd Î” (Î½0 A) ğŸ™ ğŸ˜ Î”'
  â†’ dual S S'
  â†’ mu (cons Î”' S ğŸ™)
  â†’ mu (cons (cons nil (A S) ğŸ™) S' ğŸ™)
  â†’ mu Î”

| mu/Î½1 :
  upd Î” (Î½0 A T) ğŸ™ ğŸ˜ Î”'
  â†’ dual S S'
  â†’ mu (cons Î”' (S T) ğŸ™)
  â†’ mu (cons (cons nil (A S X) ğŸ™) (S X) ğŸ™)
  â†’ mu Î”
}%
       
%======================================================%
% Arithmetic specific versions of Î¼/Î½ unfolding rules.
%======================================================%
| mu/Î¼1nat :
  upd Î” (Î¼1 (\N.\x. ((x eq zero) âŠ• (âˆƒ\y. ((x eq (suc y)) âŠ— (N y))))) T) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' ((T eq zero) âŠ• (âˆƒ\S. ((T eq (suc S)) âŠ— (Î¼1 (\N.\x. ((x eq zero) âŠ• (âˆƒ\y. ((x eq (suc y)) âŠ— (N y))))) S)))) ğŸ™)
  â†’ mu Î”

| mu/Î¼1even :
  upd Î” (Î¼1 (\E.\x. ((x eq zero) âŠ• (âˆƒ\y. ((x eq (suc(suc y))) âŠ— (E y))))) T) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' ((T eq zero) âŠ• (âˆƒ\S. ((T eq (suc(suc S))) âŠ— (Î¼1 (\E.\x. ((x eq zero) âŠ• (âˆƒ\y. ((x eq (suc(suc y))) âŠ— (E y))))) S)))) ğŸ™)
  â†’ mu Î”

| mu/Î¼2leq :
  upd Î” (Î¼2 (\L.\x.\y. ((x eq y) âŠ• (âˆƒ\y'. ((y eq (suc y')) âŠ— (L x y'))))) T1 T2) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (((T1 eq T2) âŠ• (âˆƒ\S2. ((T2 eq (suc S2)) âŠ— (Î¼2 (\L.\x.\y. ((x eq y) âŠ• (âˆƒ\y'. ((y eq (suc y')) âŠ— (L x y'))))) T1 S2))))) ğŸ™)
  â†’ mu Î”

| mu/Î¼2half :
  upd Î” (Î¼2 (\H.\x.\h. ((x eq zero) âŠ• (x eq (suc zero))) âŠ— (h eq zero) âŠ• (âˆƒ\x'.âˆƒ\h'. (x eq (suc(suc x'))) âŠ— (h eq (suc h')) âŠ— (H x' h'))) T1 T2) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (((T1 eq zero) âŠ• (T1 eq (suc zero))) âŠ— (T2 eq zero) âŠ• (âˆƒ\S1.âˆƒ\S2. (T1 eq (suc(suc S1))) âŠ— (T2 eq (suc S2)) âŠ— (Î¼2 (\H.\x.\h. ((x eq zero) âŠ• (x eq (suc zero))) âŠ— (h eq zero) âŠ• (âˆƒ\x'.âˆƒ\h'. (x eq (suc(suc x'))) âŠ— (h eq (suc h')) âŠ— (H x' h'))) S1 S2))) ğŸ™)
  â†’ mu Î”

| mu/Î¼3plus :
  upd Î” (Î¼3 (\P.\x.\y.\u. ((x eq zero) âŠ— (y eq u)) âŠ• (âˆƒ\x'.âˆƒ\u'. (x eq (suc x')) âŠ— (u eq (suc u')) âŠ— (P x' y u'))) T1 T2 T3) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' (((T1 eq zero) âŠ— (T2 eq T3)) âŠ• (âˆƒ\S1.âˆƒ\S2. (T1 eq (suc S1)) âŠ— (T3 eq (suc S2)) âŠ— (Î¼3 (\P.\x.\y.\u. ((x eq zero) âŠ— (y eq u)) âŠ• (âˆƒ\x'.âˆƒ\u'. (x eq (suc x')) âŠ— (u eq (suc u')) âŠ— (P x' y u'))) S1 T2 S2))) ğŸ™)
  â†’ mu Î”

| mu/unfold1nat :
  upd Î” (Î½1 (\N.\x. ((x â‰  zero) & (âˆ€\y. ((x â‰  (suc y)) â…‹ (N y))))) T) ğŸ™ ğŸ˜ Î”'
  â†’ mu (cons Î”' ((T â‰  zero) & (âˆ€\S. ((T â‰  (suc S)) â…‹ (Î½1 (\N.\x. ((x â‰  zero) & (âˆ€\y. ((x â‰  (suc y)) â…‹ (N y))))) S)))) ğŸ™)
  â†’ mu Î”
;

